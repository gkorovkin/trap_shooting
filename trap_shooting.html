<html lang="en">
  <head>
	<meta charset="utf-8">
	<title>submit demo</title>
	<style>
	  p {
		  margin: 0;
		  color: blue;
	  }
	  div,p {
		  margin-left: 10px;
	  }
	  span {
		  color: red;
	  }

	  table, th, td {
		  border: 1px solid black;
		  border-collapse: collapse;
	  }

	  td {
		  width: 3%
	  }
	  .tr_even {
		  background: #eeeeee
	  }
	</style>
	<script src="https://code.jquery.com/jquery-3.5.0.js"></script>
  </head>
  <body>

<div class="t-container">

  <div>
	<p>Определите стрелковые номера для генерации программы.</p>

	<div>
	  <form action="" id="get_numbers">
		<div>
		  <input type="checkbox" id="chk_1">
		  <label for="chk_1">Номер 1</label>
		  <input type="checkbox" id="chk_2">
		  <label for="chk_2">Номер 2</label>
		  <input type="checkbox" id="chk_3">
		  <label for="chk_3">Номер 3</label>
		  <input type="checkbox" id="chk_4">
		  <label for="chk_4">Номер 4</label>
		  <input type="checkbox" id="chk_5">
		  <label for="chk_5">Номер 5</label>
		  <input type="checkbox" id="chk_6">
		  <label for="chk_6">Номер 6</label>
		</div>
		<input type="submit" value="Рассчитать">
	  </form>
	</div>
  </div>
<div>
		<table id="results" width="100%" height="200px">
	  <thead>
		<tr>
		</tr>
	  </thead>

	  <tbody>
	  </tbody>
	</table>
</div>
</div>


	<script>
	  $("#get_numbers").submit(function( event ) {

		  let positions = new Array();

		  for (let idx = 1; idx <= 6; ++idx) {
			  positions.push( $('#chk_' + idx)[0].checked);
		  }

		  try
		  {
			  let collected = generateProgramm(positions);

			  fillTable(collected);
		  }
		  catch(err)
		  {
			  console.log(err);
			  $("#error_msg").val(err.toString());
		  }

		  event.preventDefault();
	  });

	  function fillTable(collected)
	  {
		  console.log(collected);

		  const header = $('#results thead tr');
		  const body = $('#results tbody');


		  header.empty();
		  body.empty();

		  if (collected.size == 0) {
			  return;
		  }

		  header.append($('<th>Стрелок</th>'));
		  for (let idx = 0; idx < 25; idx++) {
			  header.append($('<th>' + (idx + 1) + '</th>'));
		  }

		  for (let [idx, programm] of collected.entries()) {
			  let row = $('<tr class="tr_' + (idx % 2 == 0 ? 'even' : 'odd') + '"/>');
			  row.append('<td class="td_head">' + (idx + 1) + '</td>');

			  for (let idx = 0; idx < 25; ++idx)
			  {
				  let value = programm == null ? '' : programm[idx];
				  row.append('<td>' + value + '</td>');
			  }

			  body.append(row);
		  }
	  }
	  //--------------
	  const Direction = {
	LEFT: 1,
	CENTER: 2,
	RIGHT: 3
};

//randomize array
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        let temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
}
function fetchPullNumber(position, direction)
{
	if (position < 0 || 5 < position)
	{
		throw 'Invalid position passed ' + position;
	}

	return (position - 1) * 3 + direction;
}

function generateShooting(positions, defaultProgramm)
{
	let shootingPlan = new Array();

	if (positions.length != 6)
	{
		throw 'Invalid number of positions filled';
	}
	let totalCount = 0;
	let shootersCount = 0;

	for (let idx = 0; idx < positions.length; idx++)
	{
		let currentPrg = null;

		if (positions[idx])
		{
			currentPrg = defaultProgramm.slice();
			shuffleArray(currentPrg);
			//increase shooting count
			totalCount += currentPrg.length;
		}

		//store it
		shootingPlan[idx] = currentPrg;
	}

	return [totalCount, shootingPlan];
}

//console.log(fetchPullNumber(1, Direction.RIGHT));
function generateProgramm(shooters_positions)
{

	let standartProgramm = new Array();
	standartProgramm = standartProgramm.concat(Array(5).fill(Direction.CENTER));
	standartProgramm = standartProgramm.concat(Array(10).fill(Direction.LEFT));
	standartProgramm = standartProgramm.concat(Array(10).fill(Direction.RIGHT));

	let [launchCount, shootingProgram] = generateShooting( shooters_positions, standartProgramm);
	let shootersCount = parseInt(launchCount / standartProgramm.length);
	let shootingIsDone = false;
	let shootingIdx = 1;
	let currentShootingNumber = shootingProgram.keys().next().value + 1;
	let finalShootingProgram = new Map();

	while(!shootingIsDone)
	{
		for (let idx = 0; idx < shootingProgram.length; idx++)
		{
			const programm = shootingProgram[idx];

			if (programm != null)
			{
				let shooterCurrentShot = parseInt((shootingIdx - 1)/shootersCount) + 1;

				//console.log(`\tidx:${idx}, shooterCurrentShot: ${shooterCurrentShot}, currentShootingNumber:${currentShootingNumber}, pull:`, fetchPullNumber(currentShootingNumber, programm[shooterCurrentShot - 1]));
				programm[shooterCurrentShot - 1] = fetchPullNumber(currentShootingNumber, programm[shooterCurrentShot - 1]);;

				shootingIdx++;
			}

			currentShootingNumber++;

			if (5 < currentShootingNumber)
			{
				currentShootingNumber = 1;
			}
		}

		//console.log('-------');
		if (shootingIdx > launchCount)
		{
			shootingIsDone = true;
		}
	}

	return shootingProgram;
}

	  //generateProgramm([true, false, true, false, false, true]);
	  //------

	  </script>

  </body>
</html>
